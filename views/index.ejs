<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Find peers displays what projects 42 students are working on, allowing them to find peers to collaborate with.">
	<title>Find peers</title>
	<style>
		:root {
			color-scheme: dark;
			font-family: monospace;
			padding: 0;

			--accent: #ffffff;

			--search-height: 50px;
			--root-padding: 32px;

			font-size: 22px;
			letter-spacing: -0.2px;
			--font-size-1: 4ch;
			--font-size-2: 2.5ch;
			--font-size-3: 1.1ch;
			--font-size-4: 0.75ch;
		}

		body {
			background: #1a1a1a;
			background-image:
				linear-gradient(to right, #00babc11 1px, transparent 1px),
				linear-gradient(to bottom, #00babc11 1px, transparent 1px);
			background-size: 20px 20px;
			min-height: 100vh;
			padding: var(--search-height) var(--root-padding) 0px;
		}

		#title {
			font-size: var(--font-size-1);
			font-weight: bold;
			text-align: center;
		}

		#title-small {
			font-size: var(--font-size-2-5);
			font-weight: normal;
			color: #ffffff;
			text-align: center;
		}

		#description {
			font-size: var(--font-size-3);
			line-height: 1.2em;
			font-weight: bold;
			color: #ffffff;
			display: flex;
			gap: 32px;
		}

		.description-left {
			flex: 1.5;
			padding: 16px;
		}

		.description-right {
			flex: 1;
			padding: 16px;
		}

		.description {
			margin: 40px 0;
			padding: 32px;
			background: #2c7385;
			border-radius: 16px;
			box-shadow: 0 4px 16px rgba(0,0,0,0.2);
			border: 1px solid #222;
		}

		.banner {
			position: relative;
			margin: calc(-1 * var(--search-height)) calc(-1 * var(--root-padding)) 0;
			padding: calc(var(--search-height) + 64px) var(--root-padding) 64px;
			background: #78a9bd;
			width: 100vw;
			margin-left: calc(-50vw + 50%);
		}

		#projects {
			display: flex;
			flex-direction: column;
		}

		.project {
			margin: 40px 0;
			padding: 32px;
			background: #1c566d;
			border-radius: 16px;
			box-shadow: 0 4px 16px rgba(0,0,0,0.2);
			border: 1px solid #222;
		}

		.project-name {
			margin-bottom: 16px;
			font-size: var(--font-size-2);
			font-weight: bold;
			color: #4a98c5;
		}

		.project-title {
			color: var(--accent);
			transition: color 0.2s;
		}

		.users {
			max-width: 100vw;
			flex-wrap: wrap;
			display: flex;
			flex-direction: row;
		}

		.user {
			display: block;
			padding: 20px;
			width: 110px;
			display: flex;
			flex-direction: column;
			align-items: center;
			text-decoration: none;
			color: inherit;

			position: relative;
		}

		.status {
			font-size: var(--font-size-4);
		}

		.pool {
			font-size: var(--font-size-4);
		}

		.user-image {
			display: block;
			object-fit: cover;
			box-sizing: border-box;
			background-repeat: no-repeat;
			background-size: cover;
			background-position: 50% 50%;
			background-image: url(/public/placeholder.png);
			border-radius: 50%;
			align-self: center;
			overflow: hidden;
			height: 110px;
			width: 110px;
			margin-bottom: 10px;
		}

		.user:hover,
		.user:focus {
			box-shadow: 0 0 7px white;
		}

		.n-users {
			color: #aaa;
			font-size: var(--font-size-4);
			margin-left: 16px;
		}

		#search-bar {
			display: flex;
			flex-direction: row;
			align-items: center;
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			padding: 0 var(--root-padding);
			height: var(--search-height);
			background: rgb(26, 32, 126);
			box-shadow: 0 0 3px 0px black;
			font-size: var(--font-size-3);
			z-index: 2;
		}

		#search-bar > * {
			margin: 0 20px 0 0;
			font-family: inherit;
		}

		#search-bar > label {
			margin: 0 5px 0 0;
		}

		.overlay {
			position: absolute;
			right: 0;
			max-height: 12%;
		}

		.inline {
			display: inline;
			height: 15px;
			margin-top: -2px;
		}
	</style>

	<script async>
		console.log('Source: https://github.com/codam-coding-college/find-peers')

		function setTimezoneCookie() {
			const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
			document.cookie = `timezone=${timezone}; path=/; max-age=31536000`; // (1 year)
		}
		setTimezoneCookie();
	</script>
</head>

<div class="banner">
    <div id="title">
        - Find Peers -
    </div>
	<div id="title-small">
		What are 42 students working on?
	</div>
</div>

<div class="description">
<div id="description">
	<div class="description-left">
		This page displays what projects 42 students are working on, allowing them to find peers to collaborate with.<br/>
		Clicking on a user will take you to their intra profile page.<br/><br/>
		<img class="inline" src="/public/new.svg"></img> indicates that the user's project status was changed in the last <%= userNewStatusThresholdDays %> days<br/><br/>
		Built by Joppe Koers/<a href="https://profile.intra.42.fr/users/jkoers">@jkoers</a><br/>
		Maintained by Noah Mattos Oudejans/<a href="https://profile.intra.42.fr/users/nmattos-">@nmattos-</a><br/>
		<a href="https://github.com/codam-coding-college/find-peers">Source</a><br/>
	</div>
	<div class="description-right">
		This page is updated every <%= updateEveryHours %> hours. <br/><br/>
		Last update was on <%= lastUpdate %>
		<% if (lastUpdate != 'N/A') { %>
			: <%= hoursAgo %> hours ago<br/>
		<% } %>
	</div>
</div>

<body>
<div id="search-bar">
	<label for="campus-selector"> campus</label>
	<select id="campus-selector" onchange="window.location.href='/'+this.value">
		<% campuses.forEach(campus=>{ %>
			<option value="<%= campus.name %>" <% if (campusName == campus.name) { %>selected<% } %>><%= campus.name %></option>
		<% }) %>
	</select>

	<label for="status-selector"> status</label>
	<select id="status-selector" onchange="window.location.href='?status='+this.value">
		<option value="" <% if (!requestedStatus) { %>selected<% } %>>all</option>
		<% projectStatuses.forEach(status=>{ %>
			<option value="<%= status %>" <% if (requestedStatus == status) { %>selected<% } %>><%= status %></option>
		<% }) %>
	</select>

	<label for="project-selector"> project</label>
	<input list="project-datalist" id="project-selector" onchange="window.location.href='#'+this.value; this.value=''" placeholder="project name"/>
	<datalist id="project-datalist">
		<option value="">
			<% projects.forEach(project=>{ %>
		<option value="<%= project.name.toLowerCase().replaceAll(' ', '-') %>">
			<% }) %>
	</datalist>

	<label for="show-empty-projects"> show empty projects
		<input type="checkbox" id="show-empty-projects" onchange="toggleEmptyProjects()" <% if (showEmptyProjects) { %>checked<% } %> />
	</label>
	<script>
		function toggleEmptyProjects() {
			const checked = document.getElementById('show-empty-projects').checked;
			const params = new URLSearchParams(window.location.search);
			if (checked) {
				params.set('showEmptyProjects', '1');
			} else {
				params.delete('showEmptyProjects');
			}
			window.location.search = params.toString();
		}
	</script>
</div>


<div id="projects">

	<% projects.forEach(project=>{ %>
		<div class="project">
			<div class="project-name">
				<div id="<%= project.name.toLowerCase().replaceAll(' ', '-') %>" class="project-title">
					<%= project.name.toLowerCase().replaceAll(' ', '-') %>
				</div>
				<div class="n-users">
					<%= project.users.length %> users
				</div>
			</div>

			<div class="users">
				<% if (project.users.length == 0 && !requestedStatus) { %>
					<p><small> No users are subscribed to this project </small></p>
				<% } else if (project.users.length == 0) { %>
					<p> <small> No users with status <i><%= requestedStatus %></i> </small></p>
				<% } else { %>
				<% project.users.forEach(user=>{ %>
					<a class="user" href="https://profile.intra.42.fr/users/<%= user.login %>" target="_blank">
						<% if (user.new) { %>
							<img class="overlay" src="/public/new.svg"></img>
						<% } %>
						<img class="user-image" src="<%= user.image_url %>" alt="<%= user.login %>" loading="lazy"/>
						<div>
							<%= user.login %>
						</div>
						<div class="status">
							<%= user.status %>
						</div>
						<div class="pool">
							<%= user.pool %>
						</div>
					</a>
					<% }) %>
				<% } %>
			</div>
		</div>
	<% }) %>
</div>

</body>
</html>
